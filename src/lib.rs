//! Demonstates signature encode/decode round trip problem in ml_dsa

#[cfg(test)]
mod tests {
    use blake3::{hash, Hash};
    use ml_dsa::{
        EncodedSignature, EncodedVerifyingKey, KeyGen, KeyPair, MlDsa65, Signature, VerifyingKey,
        B32,
    };
    use signature::{Keypair, Signer, Verifier};

    static MESSAGE: &[u8] = b"There seems to be a round tripping issue somewhere in here";
    // Hex encoded seed that produces a signature that round-trips fine
    static GOOD: &str = "155f27eac999045cd27dc51dd07a7787fc3655493710ebfc0e45767aa3ae86de";
    // Hex encoded seed that produces a signature that does NOT round-trip successfully
    static BAD: &str = "c5b99f3bd8e9d028f404b6496df4cd717437ce91d6cdf78229715d0e8cc2bfe8";

    // This is a valid signature value that wont round trip through encode+decode:
    static BAD_SIG: [u8; 3309] = [
        165, 92, 173, 164, 83, 0, 171, 150, 97, 70, 59, 170, 59, 184, 184, 89, 114, 68, 209, 131,
        195, 100, 38, 208, 243, 240, 114, 93, 52, 99, 106, 62, 3, 178, 73, 134, 180, 44, 161, 43,
        163, 122, 83, 127, 214, 235, 136, 219, 26, 226, 29, 254, 131, 121, 219, 17, 204, 238, 32,
        68, 188, 105, 113, 122, 57, 57, 116, 5, 186, 235, 77, 103, 69, 119, 90, 65, 26, 102, 112,
        252, 151, 195, 74, 39, 52, 102, 168, 65, 36, 110, 84, 221, 217, 247, 26, 205, 162, 232,
        185, 128, 209, 91, 202, 21, 36, 157, 111, 191, 86, 20, 154, 192, 84, 62, 103, 253, 53, 155,
        191, 129, 171, 67, 147, 220, 228, 157, 43, 201, 118, 14, 8, 71, 146, 183, 228, 108, 132,
        60, 6, 83, 158, 255, 100, 219, 40, 251, 5, 69, 46, 62, 30, 253, 131, 147, 40, 160, 11, 204,
        26, 7, 120, 14, 25, 27, 202, 155, 42, 87, 199, 122, 138, 5, 158, 65, 212, 211, 128, 41, 87,
        176, 135, 226, 89, 120, 124, 246, 18, 189, 136, 128, 229, 222, 171, 254, 235, 211, 141,
        143, 141, 252, 59, 38, 26, 156, 113, 36, 159, 225, 252, 162, 196, 207, 62, 244, 206, 39,
        141, 63, 9, 55, 137, 197, 182, 35, 233, 34, 64, 245, 115, 106, 255, 206, 24, 75, 217, 215,
        23, 28, 76, 125, 105, 210, 58, 122, 186, 201, 125, 161, 250, 169, 8, 164, 214, 20, 252,
        143, 44, 135, 27, 255, 146, 225, 248, 99, 51, 79, 233, 236, 206, 0, 47, 233, 59, 73, 36,
        211, 225, 235, 1, 16, 98, 126, 68, 219, 101, 251, 63, 55, 33, 22, 50, 129, 18, 189, 82, 41,
        121, 202, 80, 195, 204, 39, 132, 130, 109, 166, 88, 82, 143, 46, 88, 13, 119, 102, 188, 92,
        221, 240, 99, 205, 198, 108, 102, 94, 240, 53, 44, 235, 199, 94, 97, 175, 244, 232, 17, 19,
        240, 173, 90, 121, 65, 63, 141, 120, 177, 172, 244, 90, 174, 207, 58, 149, 181, 60, 31,
        119, 28, 174, 28, 187, 200, 232, 38, 183, 164, 75, 42, 237, 179, 251, 54, 206, 236, 137,
        246, 75, 22, 237, 45, 5, 56, 111, 172, 174, 235, 188, 177, 225, 16, 245, 55, 14, 158, 185,
        127, 238, 170, 86, 119, 246, 197, 54, 101, 149, 236, 87, 246, 207, 36, 69, 46, 137, 83, 10,
        129, 149, 100, 23, 46, 34, 234, 187, 142, 249, 231, 117, 93, 33, 85, 162, 127, 226, 187,
        145, 171, 236, 71, 90, 175, 47, 73, 219, 141, 174, 223, 179, 43, 28, 186, 29, 188, 154, 92,
        27, 146, 246, 214, 94, 216, 116, 65, 114, 31, 52, 197, 229, 181, 112, 157, 237, 80, 149,
        10, 223, 115, 89, 33, 158, 189, 43, 197, 148, 103, 68, 210, 99, 141, 148, 206, 193, 48, 16,
        65, 8, 218, 23, 103, 212, 90, 169, 145, 220, 85, 32, 114, 31, 157, 154, 240, 34, 32, 248,
        194, 114, 173, 9, 222, 18, 249, 183, 76, 216, 106, 72, 40, 48, 104, 154, 239, 184, 93, 12,
        15, 132, 126, 77, 168, 23, 196, 79, 146, 150, 140, 122, 242, 65, 175, 156, 54, 145, 108, 0,
        41, 95, 98, 225, 52, 45, 253, 60, 110, 34, 241, 229, 28, 25, 161, 223, 132, 84, 111, 94, 7,
        93, 141, 54, 4, 11, 231, 218, 161, 138, 0, 126, 176, 67, 78, 201, 251, 50, 168, 129, 48,
        220, 80, 52, 170, 159, 40, 91, 214, 215, 201, 241, 196, 129, 43, 75, 128, 251, 122, 120,
        62, 1, 45, 211, 70, 210, 237, 89, 214, 189, 28, 206, 233, 46, 91, 202, 72, 21, 52, 107,
        233, 245, 129, 162, 89, 91, 180, 128, 83, 5, 74, 157, 97, 114, 251, 64, 45, 244, 127, 205,
        91, 37, 245, 237, 99, 175, 127, 143, 118, 76, 245, 4, 4, 54, 236, 219, 186, 51, 174, 182,
        225, 229, 98, 50, 22, 195, 41, 16, 151, 150, 174, 90, 77, 96, 67, 80, 213, 54, 214, 83, 86,
        198, 40, 33, 182, 214, 94, 70, 218, 51, 232, 253, 166, 169, 16, 126, 0, 82, 146, 11, 7, 5,
        191, 249, 219, 12, 117, 214, 220, 74, 102, 217, 232, 108, 145, 146, 105, 5, 167, 218, 16,
        53, 235, 155, 247, 244, 143, 86, 80, 90, 131, 201, 25, 15, 38, 88, 198, 97, 65, 79, 201,
        101, 136, 207, 240, 230, 23, 174, 56, 67, 238, 60, 64, 135, 158, 24, 177, 24, 116, 240,
        172, 43, 168, 166, 55, 214, 232, 192, 89, 207, 114, 221, 198, 98, 146, 232, 222, 60, 163,
        22, 22, 70, 66, 64, 103, 84, 244, 78, 16, 151, 101, 211, 79, 115, 22, 154, 122, 54, 166,
        230, 201, 20, 22, 17, 41, 145, 55, 121, 18, 161, 116, 141, 141, 14, 14, 18, 176, 189, 149,
        16, 211, 44, 41, 174, 125, 100, 241, 125, 122, 170, 119, 156, 113, 242, 180, 93, 199, 229,
        162, 184, 220, 135, 101, 244, 115, 246, 189, 184, 174, 181, 135, 106, 200, 179, 1, 27, 239,
        95, 208, 29, 23, 230, 136, 224, 248, 184, 198, 60, 87, 31, 174, 12, 200, 177, 162, 100,
        110, 127, 83, 177, 212, 177, 106, 119, 1, 12, 52, 108, 233, 8, 128, 114, 59, 76, 1, 126,
        213, 3, 29, 246, 14, 178, 16, 48, 250, 33, 12, 127, 131, 25, 84, 40, 36, 100, 132, 164,
        167, 205, 169, 247, 209, 11, 63, 39, 99, 25, 61, 80, 156, 163, 28, 162, 253, 49, 57, 125,
        174, 6, 229, 229, 183, 154, 127, 70, 163, 117, 47, 51, 125, 154, 132, 133, 243, 77, 106,
        160, 135, 70, 212, 159, 6, 110, 144, 212, 171, 36, 34, 23, 220, 164, 90, 210, 141, 125,
        153, 153, 118, 117, 11, 18, 60, 204, 154, 0, 89, 162, 85, 105, 164, 41, 139, 200, 247, 73,
        120, 236, 35, 19, 83, 102, 117, 159, 140, 252, 173, 181, 23, 114, 181, 66, 133, 101, 213,
        168, 216, 157, 112, 9, 145, 70, 156, 153, 133, 48, 26, 251, 204, 32, 146, 128, 121, 162,
        207, 16, 24, 176, 129, 191, 19, 114, 174, 97, 140, 43, 36, 135, 174, 93, 78, 255, 202, 216,
        8, 56, 106, 102, 167, 73, 98, 43, 187, 61, 6, 253, 249, 97, 178, 94, 12, 169, 40, 181, 145,
        48, 222, 154, 76, 228, 186, 108, 24, 135, 184, 139, 95, 163, 163, 26, 201, 70, 228, 131,
        39, 90, 56, 159, 203, 221, 241, 177, 125, 61, 223, 182, 59, 165, 205, 50, 119, 68, 173,
        172, 222, 254, 9, 113, 209, 84, 47, 15, 223, 209, 206, 207, 174, 218, 252, 12, 126, 121,
        249, 84, 218, 50, 196, 167, 67, 82, 165, 138, 190, 224, 171, 148, 37, 36, 167, 228, 57,
        167, 7, 170, 162, 71, 103, 221, 77, 146, 140, 33, 136, 43, 179, 103, 102, 124, 225, 20,
        250, 9, 233, 201, 96, 161, 156, 0, 44, 162, 166, 71, 246, 31, 1, 35, 70, 166, 217, 134, 8,
        172, 24, 107, 19, 49, 97, 90, 127, 68, 248, 128, 131, 10, 80, 251, 24, 240, 83, 159, 241,
        154, 219, 115, 112, 77, 191, 123, 59, 247, 93, 67, 194, 129, 47, 125, 61, 209, 108, 234,
        143, 232, 195, 167, 147, 73, 36, 73, 94, 154, 102, 238, 208, 45, 226, 56, 178, 166, 142,
        213, 159, 172, 78, 37, 191, 0, 247, 38, 216, 24, 247, 171, 172, 64, 148, 91, 92, 73, 218,
        4, 203, 83, 115, 209, 183, 124, 179, 96, 247, 233, 22, 63, 234, 45, 38, 217, 62, 38, 90,
        65, 87, 90, 208, 109, 215, 2, 171, 128, 187, 125, 46, 104, 166, 115, 202, 28, 226, 57, 249,
        246, 135, 44, 99, 151, 109, 52, 217, 157, 128, 214, 170, 237, 135, 158, 65, 35, 74, 37,
        122, 99, 87, 223, 226, 99, 98, 112, 218, 229, 187, 82, 164, 204, 82, 58, 205, 189, 154,
        177, 4, 231, 79, 135, 58, 154, 103, 182, 84, 170, 246, 62, 190, 95, 50, 112, 189, 109, 216,
        200, 205, 135, 47, 13, 252, 113, 3, 162, 13, 187, 85, 39, 121, 9, 43, 81, 245, 202, 97,
        230, 84, 226, 8, 185, 136, 46, 50, 191, 166, 110, 62, 127, 245, 87, 0, 53, 10, 98, 254,
        187, 14, 58, 84, 139, 78, 110, 35, 38, 183, 98, 146, 0, 4, 153, 78, 240, 247, 172, 128, 58,
        246, 242, 128, 168, 191, 170, 206, 119, 8, 252, 28, 138, 83, 243, 98, 219, 91, 91, 79, 195,
        252, 208, 81, 57, 118, 178, 61, 59, 155, 242, 230, 130, 27, 121, 114, 135, 82, 69, 63, 89,
        180, 187, 1, 23, 20, 130, 65, 54, 175, 216, 67, 163, 10, 198, 233, 198, 24, 193, 93, 85,
        211, 213, 147, 205, 20, 100, 119, 192, 234, 104, 109, 173, 6, 34, 199, 127, 141, 141, 130,
        58, 44, 158, 173, 129, 25, 205, 167, 121, 163, 202, 173, 166, 142, 91, 14, 144, 120, 73,
        181, 219, 74, 102, 114, 37, 122, 103, 139, 113, 172, 53, 77, 92, 42, 224, 9, 5, 172, 0,
        127, 174, 7, 106, 83, 157, 176, 196, 207, 179, 220, 134, 183, 47, 7, 16, 190, 80, 176, 226,
        132, 36, 69, 182, 16, 42, 248, 249, 226, 156, 239, 162, 137, 3, 66, 35, 1, 163, 185, 175,
        80, 28, 156, 18, 154, 22, 134, 223, 164, 58, 92, 32, 119, 204, 40, 203, 216, 40, 31, 171,
        73, 139, 83, 50, 215, 127, 17, 142, 167, 151, 157, 2, 87, 193, 108, 18, 71, 178, 10, 111,
        22, 255, 166, 125, 18, 127, 120, 18, 153, 220, 106, 214, 99, 126, 209, 253, 89, 34, 26,
        122, 248, 45, 103, 198, 204, 43, 15, 233, 99, 69, 86, 18, 195, 152, 47, 228, 240, 63, 234,
        205, 188, 101, 99, 115, 223, 92, 116, 162, 32, 60, 251, 86, 223, 229, 62, 41, 252, 51, 37,
        59, 187, 90, 181, 144, 95, 15, 247, 31, 46, 52, 177, 248, 102, 30, 38, 171, 234, 246, 97,
        148, 35, 252, 101, 214, 0, 174, 101, 191, 66, 88, 136, 194, 22, 63, 90, 68, 210, 133, 130,
        73, 150, 151, 131, 189, 224, 17, 232, 13, 144, 102, 120, 165, 125, 167, 1, 106, 142, 85,
        203, 147, 152, 191, 31, 91, 13, 158, 70, 73, 43, 102, 38, 113, 15, 27, 116, 169, 218, 227,
        88, 209, 32, 80, 53, 246, 148, 127, 43, 150, 172, 158, 28, 14, 193, 244, 99, 233, 86, 171,
        177, 183, 209, 109, 84, 66, 245, 198, 38, 175, 137, 174, 107, 175, 146, 12, 66, 220, 199,
        250, 244, 90, 60, 178, 96, 154, 140, 96, 254, 219, 121, 16, 87, 110, 189, 109, 74, 92, 57,
        213, 126, 173, 179, 174, 220, 162, 176, 73, 169, 37, 178, 229, 60, 136, 68, 219, 220, 226,
        20, 183, 218, 1, 136, 20, 147, 156, 110, 132, 247, 207, 58, 69, 35, 245, 187, 3, 139, 199,
        145, 131, 87, 95, 117, 154, 176, 95, 17, 245, 221, 45, 107, 241, 142, 239, 177, 71, 127,
        253, 138, 150, 157, 191, 128, 127, 3, 149, 108, 113, 3, 177, 193, 215, 54, 153, 200, 74,
        158, 250, 160, 95, 81, 211, 66, 198, 252, 192, 168, 68, 133, 44, 25, 166, 215, 19, 189,
        178, 238, 14, 88, 86, 242, 35, 79, 226, 103, 84, 37, 248, 227, 53, 29, 151, 59, 82, 140,
        165, 228, 156, 65, 82, 103, 26, 136, 167, 110, 18, 121, 121, 48, 205, 227, 124, 89, 77, 72,
        243, 81, 161, 146, 11, 164, 186, 120, 162, 19, 156, 173, 108, 99, 142, 122, 148, 241, 253,
        112, 172, 198, 55, 210, 67, 35, 139, 214, 79, 132, 224, 49, 75, 152, 184, 244, 128, 132,
        204, 116, 128, 76, 232, 245, 163, 105, 248, 220, 91, 207, 207, 109, 35, 160, 13, 194, 217,
        230, 121, 98, 189, 206, 231, 228, 82, 71, 70, 182, 215, 86, 27, 207, 64, 229, 79, 223, 233,
        173, 240, 57, 52, 205, 202, 23, 113, 137, 166, 196, 94, 129, 220, 43, 243, 42, 45, 216, 46,
        59, 125, 191, 167, 58, 207, 165, 142, 17, 156, 196, 123, 153, 97, 191, 61, 134, 185, 13,
        173, 188, 237, 139, 209, 22, 197, 31, 45, 170, 33, 31, 97, 171, 18, 88, 52, 184, 23, 9,
        127, 219, 162, 76, 188, 14, 209, 249, 55, 190, 252, 72, 82, 107, 37, 208, 104, 223, 145,
        77, 45, 53, 195, 142, 140, 116, 170, 227, 240, 129, 113, 247, 102, 18, 150, 33, 224, 59,
        131, 198, 102, 100, 136, 22, 143, 28, 252, 138, 240, 199, 21, 6, 123, 94, 83, 73, 214, 91,
        113, 118, 232, 227, 149, 176, 151, 24, 72, 41, 88, 35, 190, 254, 137, 85, 170, 218, 70,
        238, 178, 49, 158, 236, 39, 102, 136, 72, 53, 47, 165, 192, 44, 203, 238, 77, 157, 96, 233,
        10, 169, 210, 95, 113, 42, 233, 24, 173, 169, 133, 167, 224, 25, 14, 146, 159, 11, 150,
        192, 160, 111, 132, 95, 189, 218, 47, 143, 55, 101, 155, 77, 219, 120, 83, 65, 187, 14,
        116, 175, 219, 142, 168, 23, 194, 191, 67, 113, 122, 142, 136, 23, 97, 220, 178, 28, 247,
        227, 74, 4, 199, 110, 68, 36, 107, 231, 184, 152, 172, 144, 205, 217, 194, 109, 250, 92,
        138, 181, 221, 2, 84, 248, 10, 118, 39, 16, 2, 91, 251, 47, 152, 249, 154, 154, 151, 105,
        43, 124, 124, 124, 128, 61, 90, 59, 64, 213, 167, 77, 254, 141, 181, 16, 57, 69, 188, 242,
        117, 239, 223, 220, 181, 115, 91, 111, 192, 162, 19, 50, 140, 58, 165, 153, 62, 157, 182,
        234, 8, 51, 99, 219, 72, 27, 143, 170, 46, 106, 69, 189, 27, 79, 143, 210, 178, 176, 155,
        235, 232, 223, 140, 196, 29, 208, 98, 137, 124, 88, 59, 135, 201, 239, 123, 239, 15, 233,
        145, 181, 141, 169, 255, 22, 4, 116, 119, 8, 138, 158, 234, 174, 250, 214, 9, 161, 0, 194,
        24, 195, 124, 150, 88, 47, 153, 250, 17, 125, 145, 126, 221, 164, 40, 34, 89, 132, 82, 27,
        61, 147, 234, 170, 45, 6, 209, 36, 220, 115, 223, 27, 198, 177, 221, 254, 181, 207, 119,
        51, 64, 252, 248, 54, 210, 64, 100, 41, 48, 102, 168, 226, 0, 151, 58, 254, 173, 51, 141,
        237, 136, 226, 187, 182, 175, 145, 30, 107, 220, 151, 87, 120, 63, 131, 58, 201, 254, 149,
        220, 163, 241, 78, 5, 27, 149, 201, 238, 86, 158, 155, 179, 10, 90, 165, 97, 109, 253, 3,
        191, 82, 64, 225, 61, 244, 52, 175, 118, 36, 138, 164, 147, 240, 182, 66, 159, 101, 121,
        208, 209, 148, 68, 235, 233, 134, 89, 21, 222, 36, 218, 196, 100, 33, 107, 241, 251, 146,
        178, 122, 14, 208, 201, 134, 127, 131, 94, 27, 39, 121, 138, 113, 94, 173, 255, 64, 166,
        74, 143, 139, 18, 239, 213, 21, 250, 197, 92, 29, 251, 102, 46, 176, 144, 162, 104, 231,
        197, 215, 2, 47, 244, 114, 97, 5, 89, 101, 109, 94, 158, 12, 109, 220, 213, 158, 171, 172,
        119, 63, 46, 218, 73, 100, 143, 97, 51, 59, 132, 152, 117, 40, 184, 72, 230, 172, 146, 237,
        97, 229, 190, 249, 203, 254, 191, 19, 19, 161, 196, 227, 111, 0, 68, 249, 225, 72, 126, 61,
        13, 56, 87, 231, 162, 224, 161, 181, 217, 30, 194, 94, 11, 200, 186, 207, 96, 119, 145, 87,
        176, 227, 107, 175, 177, 12, 220, 17, 164, 253, 28, 53, 41, 105, 62, 17, 243, 198, 162, 97,
        0, 75, 52, 253, 182, 188, 188, 242, 91, 254, 217, 79, 147, 206, 79, 69, 142, 68, 20, 235,
        172, 211, 0, 23, 247, 28, 78, 223, 78, 172, 244, 94, 115, 203, 50, 165, 162, 141, 128, 11,
        246, 26, 167, 143, 12, 60, 226, 31, 212, 214, 11, 62, 235, 174, 141, 205, 78, 235, 20, 63,
        63, 215, 192, 97, 179, 32, 95, 124, 175, 78, 221, 14, 242, 44, 124, 77, 179, 55, 43, 97, 5,
        15, 188, 112, 122, 197, 153, 225, 62, 9, 213, 159, 21, 117, 243, 69, 222, 39, 177, 124, 78,
        53, 17, 17, 214, 205, 123, 16, 95, 168, 112, 148, 63, 213, 254, 177, 79, 52, 226, 251, 33,
        73, 81, 126, 202, 105, 197, 92, 187, 43, 213, 198, 208, 198, 138, 7, 231, 69, 236, 65, 12,
        2, 216, 28, 110, 54, 164, 77, 250, 1, 184, 1, 44, 121, 90, 172, 51, 81, 29, 118, 254, 93,
        145, 20, 60, 54, 240, 142, 207, 167, 240, 171, 103, 222, 185, 9, 78, 171, 198, 138, 232,
        70, 178, 229, 188, 130, 10, 184, 209, 153, 196, 156, 94, 49, 211, 203, 210, 126, 51, 44,
        58, 19, 6, 184, 67, 117, 118, 27, 29, 106, 176, 67, 182, 205, 139, 239, 195, 53, 22, 136,
        27, 6, 39, 35, 8, 0, 223, 241, 97, 3, 68, 83, 151, 84, 210, 87, 31, 98, 58, 142, 1, 21,
        186, 173, 253, 106, 39, 250, 222, 170, 125, 160, 226, 190, 178, 132, 164, 43, 247, 33, 194,
        243, 69, 158, 70, 26, 168, 64, 60, 213, 221, 223, 29, 245, 111, 64, 253, 90, 54, 120, 41,
        2, 62, 225, 18, 252, 175, 171, 8, 41, 38, 129, 146, 180, 53, 203, 116, 123, 156, 10, 129,
        198, 225, 62, 216, 27, 67, 91, 220, 213, 5, 128, 138, 36, 126, 115, 84, 170, 173, 159, 9,
        90, 152, 34, 60, 109, 220, 47, 177, 197, 15, 12, 57, 129, 165, 120, 249, 208, 219, 151, 36,
        47, 158, 86, 147, 255, 138, 31, 88, 119, 253, 212, 61, 149, 234, 99, 142, 139, 107, 30,
        220, 230, 60, 22, 157, 191, 54, 48, 19, 252, 111, 154, 128, 60, 179, 206, 72, 202, 107,
        202, 172, 212, 186, 215, 180, 21, 114, 210, 0, 173, 104, 65, 160, 186, 211, 176, 158, 168,
        106, 20, 254, 11, 233, 49, 146, 60, 97, 222, 31, 121, 67, 217, 116, 218, 124, 202, 118, 48,
        253, 79, 103, 16, 159, 152, 105, 196, 158, 93, 19, 131, 114, 160, 29, 10, 103, 103, 222,
        91, 179, 169, 60, 236, 119, 149, 99, 102, 110, 71, 229, 45, 88, 25, 25, 33, 233, 171, 116,
        126, 239, 150, 238, 103, 150, 64, 246, 44, 193, 97, 158, 0, 53, 67, 99, 203, 85, 16, 36,
        127, 106, 247, 51, 181, 104, 112, 112, 219, 58, 23, 106, 44, 156, 166, 88, 28, 97, 192,
        188, 21, 101, 64, 48, 8, 193, 135, 193, 215, 49, 247, 217, 46, 217, 54, 50, 96, 174, 117,
        42, 126, 149, 180, 127, 125, 123, 231, 240, 74, 185, 96, 252, 255, 165, 242, 13, 9, 146,
        141, 184, 115, 172, 68, 12, 155, 87, 111, 199, 170, 49, 137, 120, 149, 202, 18, 206, 118,
        216, 7, 132, 60, 252, 121, 50, 158, 84, 37, 91, 81, 78, 104, 167, 18, 186, 11, 94, 188, 60,
        212, 80, 229, 21, 43, 66, 220, 244, 249, 22, 32, 101, 133, 168, 187, 21, 35, 51, 67, 80,
        128, 36, 82, 97, 105, 147, 165, 171, 197, 31, 48, 61, 69, 85, 110, 152, 185, 211, 0, 0, 0,
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 12, 18, 26, 35, 35,
    ];

    fn gen_keypair(seed: &Hash) -> KeyPair<MlDsa65> {
        let mut hack = B32::default();
        hack.0.copy_from_slice(seed.as_bytes()); // FIXME: How do more better?
        MlDsa65::key_gen_internal(&hack)
    }

    #[test]
    fn it_works_not_finder() {
        let mut seed = Hash::from_bytes([69; 32]);
        for i in 0..420 {
            seed = hash(seed.as_bytes());
            let kp = gen_keypair(&seed);
            let sig = kp.signing_key().sign(MESSAGE);
            assert!(kp.verifying_key().verify(MESSAGE, &sig).is_ok());
            if i == 39 {
                assert_eq!(seed, Hash::from_hex(BAD).unwrap());
                assert_eq!(
                    hash(kp.signing_key().encode().as_slice()),
                    Hash::from_hex(
                        "dfeb0ddc4a2d932777f73c71e62ef03bdc4a9bc343f6cb3d212671d72aeec81d"
                    )
                    .unwrap()
                );
                assert_eq!(
                    hash(kp.verifying_key().encode().as_slice()),
                    Hash::from_hex(
                        "f0945e7a6b0c66a91078a2d5d2ed5b56872be70a5eec779dd14c396a239c0be2"
                    )
                    .unwrap()
                );
                assert_eq!(
                    hash(sig.encode().as_slice()),
                    Hash::from_hex(
                        "6bd4649f05caf55b75ac083c5182e609d8018ce6022e210c7f0cf0f22fdb557b"
                    )
                    .unwrap()
                );
                assert_eq!(sig.encode().as_slice(), BAD_SIG);
            }

            let mut pub_buf = [0; 1952];
            pub_buf.copy_from_slice(kp.verifying_key().encode().as_slice());
            let mut sig_buf = [0; 3309];
            sig_buf.copy_from_slice(sig.encode().as_slice());
            println!("{} {}", i, seed);
            let pub_enc = EncodedVerifyingKey::<MlDsa65>::try_from(&pub_buf[..]).unwrap();
            let pub_key = VerifyingKey::<MlDsa65>::decode(&pub_enc);
            let sig_enc = EncodedSignature::<MlDsa65>::try_from(&sig_buf[..]).unwrap();

            // This will fail at i=39,
            // seed=c5b99f3bd8e9d028f404b6496df4cd717437ce91d6cdf78229715d0e8cc2bfe8
            let sig = Signature::<MlDsa65>::decode(&sig_enc).unwrap();
            assert!(pub_key.verify(MESSAGE, &sig).is_ok());
        }
    }

    #[test]
    fn it_works_not() {
        let seed = Hash::from_hex(BAD).unwrap();
        let kp = gen_keypair(&seed);
        let sig = kp.signing_key().sign(MESSAGE);
        assert_eq!(sig.encode().as_slice(), BAD_SIG);
        let mut sig_buf = [0; 3309];
        sig_buf.copy_from_slice(sig.encode().as_slice());
        let sig_enc = EncodedSignature::<MlDsa65>::try_from(&sig_buf[..]).unwrap();
        let _sig = Signature::<MlDsa65>::decode(&sig_enc).unwrap();
    }

    #[test]
    fn it_works_not_with_this_sig() {
        let sig_enc = EncodedSignature::<MlDsa65>::try_from(BAD_SIG).unwrap();
        let _sig = Signature::<MlDsa65>::decode(&sig_enc).unwrap();
    }

    #[test]
    fn it_works() {
        let seed = Hash::from_hex(GOOD).unwrap();
        let kp = gen_keypair(&seed);
        let sig = kp.signing_key().sign(MESSAGE);
        let mut sig_buf = [0; 3309];
        sig_buf.copy_from_slice(sig.encode().as_slice());
        let sig_enc = EncodedSignature::<MlDsa65>::try_from(&sig_buf[..]).unwrap();
        let _sig = Signature::<MlDsa65>::decode(&sig_enc).unwrap();
    }
}
